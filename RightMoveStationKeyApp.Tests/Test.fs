module RightMoveStationKeyApp.Integration.Tests

open System
open NUnit.Framework
open FsUnit
open FSharp.Data
open System.IO
open XYZ.RightMoveStationKeyApp

[<Test>]
let ``should give rightmove keys for all stations on circle line``() = 
    let filename = "output.json"
    run filename [| "Circle" |]
    let contents = File.ReadAllText filename
    contents |> should equal """[{"station":{"name":"Aldgate","serving":["Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.075614184477749600,"Item2":51.514271823083390000}},"key":"STATION%5E140"},{"station":{"name":"Aldgate East","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":-0.072287119975365420,"Item2":51.515233413796480000}},"key":"STATION%5E140"},{"station":{"name":"Baker Street","serving":["Bakerloo","Circle","Hammersmith & City","Jubilee","Metropolitan"],"point":{"Item1":-0.156900356057780880,"Item2":51.523061248142790000}},"key":"STATION%5E488"},{"station":{"name":"Bank","serving":["Central","Circle","District","Northern","Waterloo & City"],"point":{"Item1":-0.088915809045260000,"Item2":51.513302371519344000}},"key":"STATION%5E551"},{"station":{"name":"Barbican","serving":["Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.097711123216248310,"Item2":51.520145725324900000}},"key":"STATION%5E569"},{"station":{"name":"Barking","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":0.080863182849410430,"Item2":51.539451208515715000}},"key":"STATION%5E587"},{"station":{"name":"Bayswater","serving":["Circle","District"],"point":{"Item1":-0.188038262221618460,"Item2":51.512233058741060000}},"key":"STATION%5E707"},{"station":{"name":"Blackfriars","serving":["Circle","District"],"point":{"Item1":-0.103606731219862620,"Item2":51.511490522247490000}},"key":"STATION%5E1040"},{"station":{"name":"Bow Road","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":-0.024823746874528683,"Item2":51.526800254826064000}},"key":"STATION%5E1241"},{"station":{"name":"Cannon Street","serving":["Circle","District"],"point":{"Item1":-0.090694850680980680,"Item2":51.511433722337300000}},"key":"STATION%5E1745"},{"station":{"name":"East Ham","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":0.051475548835470040,"Item2":51.538926036547580000}},"key":"STATION%5E3080"},{"station":{"name":"Embankment","serving":["Bakerloo","Circle","District","Northern"],"point":{"Item1":-0.122360215814178660,"Item2":51.507241796748396000}},"key":"STATION%5E3251"},{"station":{"name":"Euston Square","serving":["Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.135836140694320340,"Item2":51.525561006016105000}},"key":"STATION%5E3311"},{"station":{"name":"Farringdon","serving":["Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.105065254236880330,"Item2":51.520444754930790000}},"key":"STATION%5E3431"},{"station":{"name":"Gloucester Road","serving":["Circle","District","Piccadilly"],"point":{"Item1":-0.182989526482896930,"Item2":51.494239783916480000}},"key":"STATION%5E3809"},{"station":{"name":"Great Portland Street","serving":["Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.143956086447368930,"Item2":51.523720314628890000}},"key":"STATION%5E3962"},{"station":{"name":"High Street Kensington","serving":["Circle","District"],"point":{"Item1":-0.192503135590810750,"Item2":51.500673420263205000}},"key":"STATION%5E4568"},{"station":{"name":"Liverpool Street","serving":["Central","Circle","Hammersmith & City","Metropolitan"],"point":{"Item1":-0.082965709456943840,"Item2":51.517351230751740000}},"key":"STATION%5E5615"},{"station":{"name":"Mansion House","serving":["Circle","District"],"point":{"Item1":-0.094187135312932570,"Item2":51.512021200956030000}},"key":"STATION%5E6026"},{"station":{"name":"Monument","serving":["Circle","District"],"point":{"Item1":-0.088942732741562510,"Item2":51.513347819184280000}},"key":"STATION%5E6314"},{"station":{"name":"Moorgate","serving":["Circle","Hammersmith & City","Metropolitan","Northern"],"point":{"Item1":-0.089006315013091150,"Item2":51.518367249884620000}},"key":"STATION%5E6332"},{"station":{"name":"Notting Hill Gate","serving":["Central","Circle","District"],"point":{"Item1":-0.196537685407762500,"Item2":51.509063533643740000}},"key":"STATION%5E6818"},{"station":{"name":"Paddington","serving":["Bakerloo","Circle","District","Hammersmith & City"],"point":{"Item1":-0.175390006010324200,"Item2":51.515310415793490000}},"key":"STATION%5E6965"},{"station":{"name":"Plaistow","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":0.017804698696490015,"Item2":51.531218392483616000}},"key":"STATION%5E7247"},{"station":{"name":"Sloane Square","serving":["Circle","District"],"point":{"Item1":-0.156486231690913330,"Item2":51.492287824097220000}},"key":"STATION%5E8312"},{"station":{"name":"South Kensington","serving":["Circle","District","Piccadilly"],"point":{"Item1":-0.173922310883827400,"Item2":51.493999872763690000}},"key":"STATION%5E8414"},{"station":{"name":"Stepney Green","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":-0.046458666350820540,"Item2":51.521910629627830000}},"key":"STATION%5E8726"},{"station":{"name":"Tower Hill","serving":["Circle","District"],"point":{"Item1":-0.076353695174605170,"Item2":51.510065953884120000}},"key":"STATION%5E9290"},{"station":{"name":"Upton Park","serving":["Circle","District","Hammersmith & City"],"point":{"Item1":0.035273180129164805,"Item2":51.535233303921100000}},"key":"STATION%5E9458"},{"station":{"name":"West Ham","serving":["Circle","District","Hammersmith & City","Jubilee"],"point":{"Item1":0.005039507096672237,"Item2":51.528181772941785000}},"key":"STATION%5E9854"},{"station":{"name":"Westminster","serving":["Circle","District","Jubilee"],"point":{"Item1":-0.124818265200698930,"Item2":51.501084583446460000}},"key":"STATION%5E9953"},{"station":{"name":"Whitechapel","serving":["Circle","District","East London","Hammersmith & City"],"point":{"Item1":-0.059984982962259466,"Item2":51.519455246890790000}},"key":"STATION%5E10022"}]"""

[<Test>]
let ``should give rightmove keys for all stations on every line when no line args provided``() = 
    let filename = "output.json"
    run filename [| |]
    let contents = File.ReadAllText filename
    contents |> should equal """[{"station":{"name":"Blackhorse Road","serving":["Victoria"],"point":{"Item1":-0.040996340920370744,"Item2":51.586951195438930000}},"key":"STATION%5E1052"},{"station":{"name":"Brixton","serving":["Victoria"],"point":{"Item1":-0.114635581578615600,"Item2":51.462581333631725000}},"key":"STATION%5E1400"},{"station":{"name":"Euston","serving":["Northern","Victoria"],"point":{"Item1":-0.133289718799315530,"Item2":51.528596260899460000}},"key":"STATION%5E3311"},{"station":{"name":"Finsbury Park","serving":["Piccadilly","Victoria"],"point":{"Item1":-0.106512100282158470,"Item2":51.564401648484590000}},"key":"STATION%5E3515"},{"station":{"name":"Green Park","serving":["Jubilee","Piccadilly","Victoria"],"point":{"Item1":-0.142927422207874380,"Item2":51.506850108502306000}},"key":"STATION%5E3971"},{"station":{"name":"Highbury & Islington","serving":["Victoria"],"point":{"Item1":-0.103964238784979300,"Item2":51.546229491737870000}},"key":"STATION%5E4583"},{"station":{"name":"Oxford Circus","serving":["Bakerloo","Central","Victoria"],"point":{"Item1":-0.141768983668966370,"Item2":51.515123799037090000}},"key":"STATION%5E6953"},{"station":{"name":"Pimlico","serving":["Victoria"],"point":{"Item1":-0.133748665287791170,"Item2":51.489193760110520000}},"key":"STATION%5E7232"},{"station":{"name":"Seven Sisters","serving":["Victoria"],"point":{"Item1":-0.072491881494998600,"Item2":51.583354184664740000}},"key":"STATION%5E8075"},{"station":{"name":"Stockwell","serving":["Northern","Victoria"],"point":{"Item1":-0.122909311662102960,"Item2":51.472166538615750000}},"key":"STATION%5E8759"},{"station":{"name":"Tottenham Hale","serving":["Victoria"],"point":{"Item1":-0.060281116367504950,"Item2":51.588045301521500000}},"key":"STATION%5E9272"},{"station":{"name":"Vauxhall","serving":["Victoria"],"point":{"Item1":-0.123748951030590600,"Item2":51.485733376040270000}},"key":"STATION%5E9485"},{"station":{"name":"Walthamstow Central","serving":["Victoria"],"point":{"Item1":-0.019918639025007567,"Item2":51.582954705002570000}},"key":"STATION%5E9557"},{"station":{"name":"Warren Street","serving":["Northern","Victoria"],"point":{"Item1":-0.138272313383213400,"Item2":51.524511517547950000}},"key":"STATION%5E9626"}]"""